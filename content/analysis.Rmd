---
title: Analysis
description:
toc: true
featuredVideo:
featuredImage: https://upload.wikimedia.org/wikipedia/commons/7/77/Pebbleswithquarzite.jpg
draft: false
---

This comes from the file `content/analysis.Rmd`.

We describe here our detailed data analysis.


```{r}
library(tidyverse)
library(GGally)
library(patchwork)
library(tmap)
library(sf)
library(tmaptools)
print(getwd())
data <- read_csv(here::here("dataset/loan_refusal_clean.csv"))
load(here::here("dataset/loan_refusal.RData"))
print(ls())
```

```{r}
CO2_clean_1 %>% ggplot(aes(y=World,x=Year))+geom_point()+labs(y="CO2 World emission")
(summary(lm(World~Year,data=CO2_clean_1)))

CO2_temp %>% ggplot(aes(x=World,y=Mean))+geom_point()+labs(x="CO2 World emission",y="Global temp anormaly")
(summary(lm(World~Mean,data=CO2_temp)))



```
```{r Temp-Change}
source = read_csv(here::here('dataset','TempChange','TempChangeData.csv'))

TemChange_Cont = source %>%
  select(Area, `Area Code (M49)`, Months, Element, Y1961, Y1962, Y1963, Y1964, Y1965, Y1966, Y1967, Y1968, Y1969,
         Y1970, Y1971, Y1972, Y1973, Y1974, Y1975, Y1976, Y1977, Y1978, Y1979,
         Y1980, Y1981, Y1982, Y1983, Y1984, Y1985, Y1986, Y1987, Y1988, Y1989,
         Y1990, Y1991, Y1992, Y1993, Y1994, Y1995, Y1996, Y1997, Y1998, Y1999,
         Y2000, Y2001, Y2002, Y2003, Y2004, Y2005, Y2006, Y2007, Y2008, Y2009,
         Y2010, Y2011, Y2012, Y2013, Y2014, Y2015, Y2016, Y2017, Y2018, Y2019, 
         Y2020, Y2021) %>%
  filter(Months == 'Meteorological year', Element == 'Temperature change') %>%
  select(-Months, -Element) %>%
  mutate(`Area Code (M49)` = str_sub(`Area Code (M49)`, -3, -1))

TemChange_Year = TemChange_Cont %>%
  pivot_longer(Y1961 : Y2021, names_to = 'year', values_to = 'change') %>%
  mutate(year = as.numeric(str_sub(year, -4, -1)))

world_map = st_read(here::here('dataset', 'worldmap', 'ne_50m_admin_0_countries.shp'), quiet = TRUE)

TemChange_Cont = left_join(TemChange_Cont, world_map, c("Area Code (M49)" = 'ISO_N3')) %>%
  filter(!is.na(TYPE)) %>% st_as_sf()

TemChange_Year = left_join(TemChange_Year, world_map, c("Area Code (M49)" = 'ISO_N3')) %>%
  filter(!is.na(TYPE)) %>% select(Area, year, change, geometry) %>% st_as_sf()

pal7 <- c('#084A92', '#FEE7DC', '#FCC0A8', '#FB9070', '#F75A40', '#D92522', '#AC1016')

total_change <- function(x, y){
  x = x - 1958
  y = y - 1958
  Pic_data = TemChange_Cont %>% as_tibble() %>% select(x:y) %>%
    mutate(total = apply(., 1, sum, na.rm = TRUE)) %>%
    cbind(TemChange_Cont[, 1]) %>% select(Area, total) %>%
    cbind(TemChange_Cont[, "geometry"]) %>% st_as_sf()
  Pic = tm_shape(world_map) + tm_borders() +
    tm_shape(Pic_data) + 
    tm_polygons(col = 'total', palette = pal7, midpoint = NA, n = 7)
  return(Pic)
}

total_change(1961,2021) #between any two years
```


```{r year-variables}
p1 = World_data %>% ggplot(aes(as.numeric(Year),temperature)) + geom_line() +
  labs(x = 'year', y = 'temperature', title = 'The trend of temperature')

p2 = World_data %>% ggplot(aes(as.numeric(Year),`forest area`)) + geom_line() +
  labs(x = 'year', y = 'forest area', title = 'The trend of forest area')

p3 = World_data %>% ggplot(aes(as.numeric(Year),population)) + geom_line() +
  labs(x = 'year', y = 'population', title = 'The trend of population')

p4 = World_data %>% ggplot(aes(as.numeric(Year),Gas)) + geom_line() +
  labs(x = 'year', y = 'Gas', title = 'Gas trend')

p5 = World_data %>% ggplot(aes(as.numeric(Year),Oil)) + geom_line() +
  labs(x = 'year', y = 'Oil', title = 'Oil trend')

p6 = World_data %>% ggplot(aes(as.numeric(Year),Coal)) + geom_line() +
  labs(x = 'year', y = 'Coal', title = 'Coal trend')

p7 = World_data %>% ggplot(aes(as.numeric(Year),CO2emission)) + geom_line() +
  labs(x = 'year', y = 'CO2emission', title = 'CO2emission trend')

p1 / (p2|p3)
(p4|p5) / (p6|p7)
```

```{r mod}
attach(World_data)
World_data %>% select(-`Country Name`, -Year) %>%
  ggpairs(upper = list(continuous = wrap('points', alpha = .3, size = .1)),
          lower = list(continuous = wrap('cor', size = 4))) 

mlr1 = lm(temperature ~ `forest area` + World_data$population + Gas + Oil + Coal + CO2emission)
summary(mlr1)

mlr2 = lm(temperature ~ World_data$population + Gas + Oil + Coal + CO2emission)
summary(mlr2)

mlr3 = lm(temperature ~ World_data$population + Gas + Coal + CO2emission)
summary(mlr3)

mlr4 = lm(temperature ~ World_data$population + Coal + CO2emission)
summary(mlr4)

mlr5 = lm(temperature ~ Coal + CO2emission)
summary(mlr5)

step(mlr, direction = 'both') #same with above
```

## Note on Attribution

If you are directly quoting from a source, please make that clear. You can show quotes using `>` like this

```
> To be or not to be.
```

> To be or not to be.

Also, make sure to provide a link or citation to where you are quoting from.

-------


## Rubric: On this page

you will


* Introduce what motivates your Data Analysis (DA)
  * Which variables and relationships are you most interested in?
  * What questions are you interested in answering?
* Breadth of the DA
  * Make sure that you ask enough initial questions to explore the different variables in your data.
  * i.e. Do you explore more than just one or two variables? Do you explore a few different relationships or many?
* Depth of the DA
  * When you answer one question, usually more questions arise as well. 
  * The depth of the DA is about coming up with and exploring the answers to these questions, often iterating the process a few times.
* Modeling and Inference 
  * You should also include some kind of formal statistical model and/or inference. This could be a linear regression, logistic regression, hypothesis testing etc.
  * Explain the techniques you used for validating your results.
  * Describe the results of your modelling and make sure to give a sense of the uncertainty in your estimates and conclusions.
* Explain the flaws and limitations of your analysis
  * Are there some assumptions that you needed to make that might not hold? Is there other data that would help to answer your questions? ...
* Clarity Figures
  * Are your figures/tables/results easy to read, informative, without problems like overplotting, hard-to-read labels, etc?
  * Each figure should provide a key insight. Too many figures or other data summaries can detract from this.
* Clarity of Explanations
  * Do you introduce why you are doing each analysis?
  * How well do you explain each figure/result?
  * Do you provide interpretations that suggest further analysis or explanations for observed phenomenon?
* Organization and cleanliness.
  * Make sure to remove excessive warnings, use clean easy-to-read code, organize with sections or multiple pages, use bullets, etc.
  
  
**NOTE**: Your Data Analysis can be broken up into multiple pages if that helps with your organization.